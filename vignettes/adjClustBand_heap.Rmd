---
title: "Adjacency-constrained hierarchical clustering of linkage disequilibrium"
author: "Pierre Neuvial, Shubham Chaturvedi"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Adjacency-constrained hierarchical clustering of linkage disequilibrium}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


In this short vignette we demonstrate the use of `adjClustBand_heap` function in the `adjclust` package to perform adjacency-constrained hierarchical clustering of Linkage Disequilibrium data.

```{r}
library("adjclust")
```

## Loading and displaying genotype data

The begining of this vignette closely follows the "LD vignette" of the SnpStats package [1]. First, we load genotype data.

```{r, results="hide", message=FALSE}
library("matrixStats")
library("snpStats")
data("ld.example", package="snpStats")
```

```{r, echo=FALSE}
p <- ncol(ceph.1mb)
nSamples <- nrow(ceph.1mb)
```

We focus on the `ceph.1mb` data. These data are drawn from the International HapMap Project and concern `r p` SNPs over a 1Mb region of chromosome 22 in sample of `r nSamples` Europeans.

```{r}
ceph.1mb
```

We can compute and display the LD between these SNPs.

```{r}
ld.ceph <- ld(ceph.1mb, stats="R.squared", depth=p-1)
image(ld.ceph, lwd=0)
```


## Adjacency-constrained Hierarchical Agglomerative Clustering

The above figure suggests that the LD signal is concentrated close to the diagonal. Therefore, we focus on a diagonal band:

```{r}
h <- 100
ld.ceph <- ld(ceph.1mb, stats="R.squared", depth=h)
image(ld.ceph, lwd=0)
```


## Check data for presence of missing values or NaNs and eliminate them

```{r}
any(is.na(ld.ceph))

#which(is.na(ld.ceph), arr.ind = TRUE)

ceph.1mb[4,286]@.Data[1,1] <- as.raw(3)  ## to avoid NaNs
ld.ceph <- ld(ceph.1mb, stats="R.squared", depth=h)  ##calculate LD values again after NaN correction
ld.ceph <- round(ld.ceph, digits=10)  ## precision above 1e-10 is not required for this example
any(is.na(ld.ceph))
diag(ld.ceph) <- 1
```


### Using "crayons"

```{r}
fit <- adjClustBand_heap(ld.ceph, "similarity", h, blMin=1)
```

This function implements the algorithm described in the third chapter of [2]. It is an extension of the algorithm described in [3].  The output is of class "hclust" a can be plotted as a dendrogram:

```{r}
plot(fit)
```
In particular, the output contains an element named `merge` which describes the successive merges of the clustering, and an element `gains` which gives the improvement in the criterion optimized by the clustering at each successive merge:

```{r}
head(cbind(fit$merge, fit$gains))
```


## References

[1] Clayton, D. (2015). snpStats: SnpMatrix and XSnpMatrix classes and methods. R package version 1.20.0

[2] Dehman A. (2015). [Spatial clustering of linkage disequilibrium blocks for genome-wide association studies](https://tel.archives-ouvertes.fr/tel-01288568/). Phd Thesis, UniversitÃ© Paris Saclay.

[3] Dehman, A. Ambroise, C. and Neuvial, P. (2015). Performance of a blockwise approach in variable selection using linkage disequilibrium information. *BMC Bioinformatics* 16:148.


## Session information

```{r}
sessionInfo()
```
